# SPEC-006: 统一文档翻译功能

> 起草日期: 2026-01-09
> 状态: 已完成

## 概述

统一 PDF 和 PPT 的翻译体验，提供一致的操作方式和界面布局。

## 功能需求

### 1. 界面布局

```
┌─────────────────────────────────────────────────────────────────────────┐
│  [新建]  [语种: 英→中 ▼]                    [翻译当前页] [翻译全部] [下载] │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────┐      ┌─────────────────────────┐          │
│  │                         │      │                         │          │
│  │      原文文档           │      │      翻译结果           │          │
│  │      (PDF/PPT)          │      │      (翻译后预览)       │          │
│  │                         │      │                         │          │
│  └─────────────────────────┘      └─────────────────────────┘          │
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│  ◀  [1] / 10  ▶                              [进度条/滑块]              │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2. 顶部工具栏

| 按钮 | 功能 |
|------|------|
| 新建 | 重新上传新文件（PDF/PPT） |
| 语种 | 下拉选择翻译方向（英→中 / 中→英） |
| 翻译当前页 | 翻译当前显示的页面 |
| 翻译全部 | 翻译整个文档所有页面 |
| 下载 | 导出翻译后的文档 |

### 3. 翻译模式

#### 3.1 翻译当前页
- 点击后翻译当前显示的单页
- 右侧实时显示翻译结果预览
- 适合逐页审核翻译质量

#### 3.2 翻译全部
- 批量翻译整个文档
- 显示翻译进度（如：3/10 页）
- 完成后可翻页查看所有结果

#### 3.3 截图翻译（可选）
- 框选区域进行局部翻译
- 弹窗显示 OCR 结果和翻译
- 可手动调整翻译位置

### 4. 语种设置

支持的翻译方向：
- 英文 → 中文（默认）
- 中文 → 英文

下拉菜单或切换按钮，切换后影响后续所有翻译操作。

### 5. 文件操作

#### 5.1 新建/导入
- 点击"新建"按钮或拖拽新文件
- 支持格式：.pdf, .pptx
- 自动识别文件类型

#### 5.2 下载/导出
- PDF 文件：导出翻译后的 PDF
- PPT 文件：导出翻译后的 PPTX
- 文件名：`原文件名_translated.pdf/pptx`

### 6. 布局保持约束

**核心原则**：翻译后的文档必须保持原文档的布局不变。

| 属性 | 要求 |
|------|------|
| 文字位置 | 翻译后文字的位置与原文完全一致 |
| 文字大小 | 字号保持不变 |
| 字体样式 | 尽量保持原有字体（粗体、斜体等） |
| 文本框尺寸 | 保持原有边界，不溢出 |

**实现方式**：

- **PDF**：在原文位置覆盖白色背景，然后绘制翻译文字
- **PPT**：
  - 只替换文本框（TextFrame）中的文字内容
  - 保留原有字体、大小、颜色、粗体/斜体等样式
  - 保留图片、图表、SmartArt 等非文本元素不变
  - 不改变任何元素的位置（left, top, width, height）

**溢出处理**：
- 如果翻译文本过长，自动缩小字号以适应原有空间
- 缩小比例不超过原字号的 70%，否则截断并标记

### 7. 翻译流程

```
用户上传文件 (PDF/PPT)
       ↓
后端解析，生成每页预览图
       ↓
前端左侧显示原文预览
       ↓
用户选择翻译方式：
  ├─ 翻译当前页 → 翻译单页 → 右侧显示结果
  └─ 翻译全部 → 批量翻译 → 显示进度 → 完成
       ↓
用户点击"下载"导出文件
```

### 8. 状态显示

每页显示翻译状态：
- 待翻译（灰色）
- 翻译中（蓝色/动画）
- 已翻译（绿色）
- 翻译失败（红色）

### 9. API 设计

统一使用以下 API：

| 端点 | 方法 | 功能 |
|------|------|------|
| `/api/doc/upload` | POST | 上传文档（PDF/PPT） |
| `/api/doc/translate` | POST | 翻译单页 |
| `/api/doc/translate-all` | POST | 翻译全部 |
| `/api/doc/export` | GET | 导出翻译后文档 |

### 10. 实现步骤

1. **后端**：
   - [ ] 统一文档上传 API
   - [ ] 统一翻译 API（区分 PDF/PPT）
   - [ ] 统一导出 API

2. **前端**：
   - [ ] 重构工具栏（新建、语种、翻译、下载）
   - [ ] 统一左右分栏布局
   - [ ] 统一底部分页控件
   - [ ] 添加翻译状态显示

3. **复用**：
   - [ ] 复用现有 PDF 翻译逻辑
   - [ ] 复用现有 PPT 解析逻辑
   - [ ] 复用豆包翻译 API

## 验收标准

1. 能上传 PDF 和 PPT 文件
2. 能选择翻译方向（英↔中）
3. 能翻译当前页或全部页面
4. 翻译后右侧实时显示结果
5. 能下载翻译后的文档
6. 统一的用户体验
